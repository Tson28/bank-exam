<div class="exam-management">
  <div class="management-header">
    <h1>Qu·∫£n l√Ω ƒë·ªÅ thi</h1>
    <button class="create-btn" (click)="createNewExam()">
      <i class="fas fa-plus"></i> T·∫°o ƒë·ªÅ thi m·ªõi
    </button>
  </div>
  
  <div class="success-message" *ngIf="successMessage">
    <div class="message-content">
      <i class="fas fa-check-circle"></i>
      <span>{{ successMessage }}</span>
    </div>
    <div class="exam-link-container" *ngIf="createdExamLink">
      <div class="link-header">
        <h3>ƒê∆∞·ªùng d·∫´n l√†m b√†i:</h3>
        <span class="password-indicator" *ngIf="requiresPassword">
          <i class="fas fa-lock"></i> Y√™u c·∫ßu m·∫≠t kh·∫©u
        </span>
      </div>
      <div class="link-value">
        <input type="text" readonly [value]="getFullExamLink()" #examLinkInput>
        <button (click)="copyExamLink(examLinkInput)" class="copy-btn">
          <i class="fas fa-copy"></i> Sao ch√©p
        </button>
      </div>
    </div>
  </div>
  
  <div class="filters">
    <div class="filter-item">
      <label for="subject-filter">B·ªô c√¢u h·ªèi:</label>
      <select id="subject-filter" [(ngModel)]="filterSubject">
        <option value="">T·∫•t c·∫£</option>
        <option *ngFor="let subject of subjects" [value]="subject">{{ subject }}</option>
      </select>
    </div>
    <div class="filter-item">
      <label for="status-filter">Tr·∫°ng th√°i:</label>
      <select id="status-filter" [(ngModel)]="filterStatus">
        <option value="">T·∫•t c·∫£</option>
        <option value="published">ƒê√£ xu·∫•t b·∫£n</option>
        <option value="draft">B·∫£n nh√°p</option>
        <option value="closed">ƒê√£ k·∫øt th√∫c</option>
      </select>
    </div>
  </div>
  
  <div class="loading-indicator" *ngIf="loading">
    <div class="spinner"></div>
    <p>ƒêang t·∫£i...</p>
  </div>
  
  <div class="exams-table-container" *ngIf="!loading">
    <table class="exams-table">
      <thead>
        <tr>
          <th>T√™n ƒë·ªÅ thi</th>
          <th>B·ªô c√¢u h·ªèi</th>
          <th>S·ªë c√¢u h·ªèi</th>
          <th>Th·ªùi gian</th>
          <th>Quy·ªÅn truy c·∫≠p</th>
          <th>ƒê∆∞·ªùng d·∫´n b√†i thi</th>
          <th>Ng√†y xu·∫•t b·∫£n</th>
          <th>Tr·∫°ng th√°i</th>
          <th>L∆∞·ª£t l√†m</th>
          <th>ƒêi·ªÉm TB</th>
          <th>Thao t√°c</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let exam of getFilteredExams()" [ngClass]="{'draft': exam.status === 'draft', 'published': exam.status === 'published', 'closed': exam.status === 'closed'}">
          <td>{{ exam.title }}</td>
          <td>{{ exam.questionSetTitle }}</td>
          <td>{{ exam.questionCount }}</td>
          <td>{{ exam.duration }} ph√∫t</td>
          <td>
            <span *ngIf="exam.accessType === 'public'">C√¥ng khai</span>
            <span *ngIf="exam.accessType === 'class'">L·ªõp: {{ exam.className }}</span>
            <span *ngIf="exam.accessType === 'selected'">{{ exam.selectedStudentIds?.length || 0 }} h·ªçc sinh</span>
          </td>
          <td class="exam-link-cell">
            <div class="exam-link-display">
              <span class="link-prefix" title="Nh·∫•p ƒë·ªÉ sao ch√©p">{{ getExamLinkPrefix(exam.id) }}</span>
              <button class="copy-link-btn" (click)="copyExamUrl(exam.id)" title="Sao ch√©p ƒë∆∞·ªùng d·∫´n">
                <i class="fas fa-copy"></i>
              </button>
              <span class="password-tag" *ngIf="exam.requirePassword">
                <i class="fas fa-lock"></i>
              </span>
            </div>
          </td>
          <td>{{ exam.publishDate ? (exam.publishDate | date:'dd/MM/yyyy') : 'Ch∆∞a xu·∫•t b·∫£n' }}</td>
          <td>
            <span class="status-badge" [ngClass]="exam.status">
              <span *ngIf="exam.status === 'published'">ƒê√£ xu·∫•t b·∫£n</span>
              <span *ngIf="exam.status === 'draft'">B·∫£n nh√°p</span>
              <span *ngIf="exam.status === 'closed'">ƒê√£ k·∫øt th√∫c</span>
            </span>
          </td>
          <td>{{ exam.attemptCount || '‚Äî' }}</td>
          <td>{{ exam.averageScore ? (exam.averageScore | number:'1.1-1') : '‚Äî' }}</td>
          <td class="actions">
            <button class="action-btn edit" title="Ch·ªânh s·ª≠a" (click)="editExam(exam.id)" *ngIf="exam.status === 'draft'">
              <i class="fas fa-edit"></i>
            </button>
            <button *ngIf="exam.status === 'draft'" class="action-btn publish" title="Xu·∫•t b·∫£n" (click)="publishExam(exam.id)">
              <i class="fas fa-upload"></i>
            </button>
            <button *ngIf="exam.status === 'published'" class="action-btn close" title="K·∫øt th√∫c" (click)="closeExam(exam.id)">
              <i class="fas fa-lock"></i>
            </button>
            <button *ngIf="exam.status !== 'draft'" class="action-btn results" title="Xem k·∫øt qu·∫£" (click)="viewResults(exam.id)">
              <i class="fas fa-chart-bar"></i>
            </button>
            <button class="action-btn delete" title="X√≥a" (click)="deleteExam(exam.id)">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <div class="empty-state" *ngIf="!loading && getFilteredExams().length === 0">
    <div class="empty-icon">üìù</div>
    <h3>Kh√¥ng t√¨m th·∫•y ƒë·ªÅ thi n√†o</h3>
    <p *ngIf="filterSubject || filterStatus">Th·ª≠ thay ƒë·ªïi b·ªô l·ªçc ƒë·ªÉ xem nhi·ªÅu ƒë·ªÅ thi h∆°n</p>
    <button class="create-btn" (click)="createNewExam()">
      <i class="fas fa-plus"></i> T·∫°o ƒë·ªÅ thi m·ªõi
    </button>
  </div>
</div>
