<div class="exam-results">
  <div class="header-actions">
    <button class="back-btn" (click)="backToExams()">
      <i class="fas fa-arrow-left"></i> Quay l·∫°i
    </button>
    <h1>K·∫øt qu·∫£ ƒë·ªÅ thi</h1>
    <button class="export-btn" (click)="exportResults()">
      <i class="fas fa-file-export"></i> Xu·∫•t k·∫øt qu·∫£
    </button>
  </div>
  
  <div class="loading-indicator" *ngIf="loading">
    <div class="spinner"></div>
    <p>ƒêang t·∫£i...</p>
  </div>
  
  <div class="error-message" *ngIf="error">
    <p>{{ error }}</p>
    <button (click)="backToExams()">Quay l·∫°i</button>
  </div>
  
  <div class="exam-info" *ngIf="exam && !loading && !error">
    <h2>{{ exam.title }}</h2>
    <div class="exam-details">
      <div class="detail-item">
        <span class="label">B·ªô c√¢u h·ªèi:</span>
        <span class="value">{{ exam.questionSetTitle }}</span>
      </div>
      <div class="detail-item">
        <span class="label">S·ªë c√¢u h·ªèi:</span>
        <span class="value">{{ exam.questionCount }}</span>
      </div>
      <div class="detail-item">
        <span class="label">Th·ªùi gian:</span>
        <span class="value">{{ exam.duration }} ph√∫t</span>
      </div>
      <div class="detail-item">
        <span class="label">Ng√†y xu·∫•t b·∫£n:</span>
        <span class="value">{{ exam.publishDate | date:'dd/MM/yyyy' }}</span>
      </div>
    </div>
  </div>
  
  <div class="statistics" *ngIf="examResults.length > 0 && !loading && !error">
    <h3>Th·ªëng k√™ k·∫øt qu·∫£</h3>
    <div class="stat-cards">
      <div class="stat-card">
        <div class="stat-value">{{ avgScore | number:'1.1-1' }}</div>
        <div class="stat-label">ƒêi·ªÉm trung b√¨nh</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">{{ maxScore | number:'1.1-1' }}</div>
        <div class="stat-label">ƒêi·ªÉm cao nh·∫•t</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">{{ minScore | number:'1.1-1' }}</div>
        <div class="stat-label">ƒêi·ªÉm th·∫•p nh·∫•t</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">{{ passCount }}</div>
        <div class="stat-label">ƒê·∫°t</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">{{ failCount }}</div>
        <div class="stat-label">Ch∆∞a ƒë·∫°t</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">{{ examResults.length }}</div>
        <div class="stat-label">T·ªïng s·ªë l∆∞·ª£t l√†m</div>
      </div>
    </div>
  </div>
  
  <div class="results-filter" *ngIf="examResults.length > 0 && !loading && !error">
    <div class="search-box">
      <input 
        type="text" 
        [(ngModel)]="filterName" 
        placeholder="T√¨m ki·∫øm theo t√™n h·ªçc sinh..."
      />
      <i class="fas fa-search"></i>
    </div>
  </div>
  
  <div class="results-table-container" *ngIf="examResults.length > 0 && !loading && !error">
    <table class="results-table">
      <thead>
        <tr>
          <th (click)="setSorting('studentName')">
            T√™n h·ªçc sinh
            <i class="fas" [ngClass]="getSortIcon('studentName')"></i>
          </th>
          <th (click)="setSorting('score')">
            ƒêi·ªÉm s·ªë
            <i class="fas" [ngClass]="getSortIcon('score')"></i>
          </th>
          <th (click)="setSorting('correctAnswers')">
            S·ªë c√¢u ƒë√∫ng
            <i class="fas" [ngClass]="getSortIcon('correctAnswers')"></i>
          </th>
          <th (click)="setSorting('totalQuestions')">
            T·ªïng s·ªë c√¢u
            <i class="fas" [ngClass]="getSortIcon('totalQuestions')"></i>
          </th>
          <th (click)="setSorting('startTime')">
            Th·ªùi gian b·∫Øt ƒë·∫ßu
            <i class="fas" [ngClass]="getSortIcon('startTime')"></i>
          </th>
          <th (click)="setSorting('duration')">
            Th·ªùi gian l√†m b√†i
            <i class="fas" [ngClass]="getSortIcon('duration')"></i>
          </th>
          <th (click)="setSorting('completed')">
            Tr·∫°ng th√°i
            <i class="fas" [ngClass]="getSortIcon('completed')"></i>
          </th>
          <th>Chi ti·∫øt</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let result of getFilteredResults()" 
            [ngClass]="{'completed': result.completed, 'incomplete': !result.completed}">
          <td>{{ result.studentName }}</td>
          <td class="score-cell" [ngClass]="{'pass': result.score >= 5, 'fail': result.score < 5}">
            {{ result.completed ? (result.score | number:'1.1-1') : '‚Äî' }}
          </td>
          <td>{{ result.correctAnswers }} / {{ result.totalQuestions }}</td>
          <td>{{ result.totalQuestions }}</td>
          <td>{{ result.startTime | date:'dd/MM/yyyy HH:mm' }}</td>
          <td>{{ result.completed ? (result.duration + ' ph√∫t') : '‚Äî' }}</td>
          <td>
            <span class="status-badge" [ngClass]="result.completed ? 'completed' : 'incomplete'">
              {{ result.completed ? 'ƒê√£ ho√†n th√†nh' : 'Ch∆∞a ho√†n th√†nh' }}
            </span>
          </td>
          <td class="actions">
            <button class="detail-btn" title="Xem chi ti·∫øt" (click)="viewStudentDetail(result.id)">
              <i class="fas fa-eye"></i>
            </button>
            <button class="history-btn" title="Xem l·ªãch s·ª≠ l√†m b√†i" (click)="viewStudentHistory(result.studentId, result.studentName)">
              <i class="fas fa-history"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <div class="empty-state" *ngIf="examResults.length === 0 && !loading && !error">
    <div class="empty-icon">üìä</div>
    <h3>Ch∆∞a c√≥ h·ªçc sinh n√†o l√†m ƒë·ªÅ thi n√†y</h3>
    <p>K·∫øt qu·∫£ s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y khi h·ªçc sinh b·∫Øt ƒë·∫ßu l√†m b√†i</p>
    <button class="back-btn" (click)="backToExams()">
      <i class="fas fa-arrow-left"></i> Quay l·∫°i
    </button>
  </div>
</div> 